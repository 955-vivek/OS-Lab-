#include <stdio.h>
#include <stdlib.h>
#include <limits.h>

typedef struct Process {
    int PID, AT, BT, TAT, WT, CT, ST, RT, priority;
} Process;

int findMaxPriority(Process *P, int ct, int n, int *cp) {
    int maxPriority = -1, maxPID = -1;
    for (int i = 0; i < n; i++) {
        if (P[i].AT <= ct && cp[i] != 0 && P[i].priority > maxPriority) {
            maxPriority = P[i].priority;
            maxPID = i;
        }
    }
    return maxPID;
}

int main() {
    int n;
    printf("Number of processes: ");
    scanf("%d", &n);
    Process P[n];

    printf("Enter the Arrival time, Burst time, and Priority for %d processes:\n", n);
    for (int i = 0; i < n; i++) {
        printf("Enter Arrival time, Burst time, and Priority for Process %d: ", i + 1);
        scanf("%d%d%d", &P[i].AT, &P[i].BT, &P[i].priority);
        P[i].PID = i + 1;
    }

    int cur_t = 0, completed = 0, isCompleted[n];
    for (int i = n - 1; i >= 0; i--) isCompleted[i] = P[i].BT;
    int STAT = 0, SWT = 0, SBT = 0;
    float ATAT, AWT, CPU, throughput;

    do {
        int maxPriorityPID = findMaxPriority(P, cur_t, n, isCompleted);
        if (maxPriorityPID != -1) {
            if (isCompleted[maxPriorityPID] == P[maxPriorityPID].BT) {
                P[maxPriorityPID].ST = cur_t;
            }

            isCompleted[maxPriorityPID]--;

            if (isCompleted[maxPriorityPID] == 0) {
                completed++;
                P[maxPriorityPID].CT = cur_t + 1;
                P[maxPriorityPID].TAT = P[maxPriorityPID].CT - P[maxPriorityPID].AT;
                P[maxPriorityPID].WT = P[maxPriorityPID].TAT - P[maxPriorityPID].BT;
                P[maxPriorityPID].RT = P[maxPriorityPID].ST - P[maxPriorityPID].AT;

                STAT += P[maxPriorityPID].TAT;
                SWT += P[maxPriorityPID].WT;
                SBT += P[maxPriorityPID].BT;
                
            }
        }
        cur_t++;
    } while (completed != n);

    ATAT = (float)STAT / n;
    AWT = (float)SWT / n;
    CPU = ((float)SBT / cur_t) * 100;
    throughput = (float)n / cur_t;

    printf("\nPID\tAT\tBT\tPri\tST\tCT\tTAT\tWT\tRT\n");
    for (int i = 0; i < n; i++) {
        printf("P%d\t%d\t%d\t%d\t%d\t%d\t%d\t%d\t%d\n",
               P[i].PID, P[i].AT, P[i].BT, P[i].priority, P[i].ST, P[i].CT,
               P[i].TAT, P[i].WT, P[i].RT);
    }

    printf("\nSum of Turnaround Time: %d\nAverage Turnaround Time: %.2f\n", STAT, ATAT);
    printf("Sum of Waiting Time: %d\nAverage Waiting Time: %.2f\n", SWT, AWT);
    printf("CPU Utilization: %.2f%%\nThroughput: %.2f process/unit time\n", CPU, throughput);

    return 0;
}
